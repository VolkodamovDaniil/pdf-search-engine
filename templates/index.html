<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ PDF</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .flash { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .document-list { margin-top: 20px; }
        .document-item { 
            margin: 10px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
            background: #f9f9f9;
        }
        .document-actions { margin-top: 10px; }
        .btn { 
            padding: 5px 10px; 
            margin-right: 10px; 
            text-decoration: none; 
            border-radius: 3px; 
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            display: inline-block;
        }
        .btn:hover { background: #0056b3; }
        .btn-danger { 
            background: #dc3545; 
            border-color: #dc3545; 
        }
        .btn-danger:hover { background: #c82333; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 400px;
            text-align: center;
        }
        .modal-buttons {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üìÑ –ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ PDF</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <h2>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å PDF</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".pdf" required>
        <button type="submit" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer;">–ó–∞–≥—Ä—É–∑–∏—Ç—å PDF</button>
    </form>
    
    <h2>üìã –î–æ–∫—É–º–µ–Ω—Ç—ã ({{ documents|length }})</h2>
    <div class="document-list">
        {% if documents %}
            {% for doc in documents %}
            <div class="document-item">
                <strong>{{ doc.original_name }}</strong><br>
                –†–∞–∑–º–µ—Ä: {{ (doc.file_size / 1024)|round(2) }} –ö–ë | 
                –Ø–∑—ã–∫: {{ doc.language }} | 
                –ó–∞–≥—Ä—É–∂–µ–Ω: {{ doc.upload_date.strftime('%Y-%m-%d %H:%M') }} |
                –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ doc.category or '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞' }}

                
                <div class="document-actions">
                    <a href="{{ url_for('view_document', doc_id=doc.id) }}" class="btn">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                    <button onclick="confirmDelete({{ doc.id }}, '{{ doc.original_name|replace("'", "\\'") }}')" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.</p>
        {% endif %}
    </div>
    
    <h2>üîç –ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö</h2>
    <form action="/search" method="get">
        <input type="text" name="q" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..." required style="padding: 8px; width: 300px;">
        <button type="submit" style="padding: 8px 15px; background: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer;">–ü–æ–∏—Å–∫</button>
    </form>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "<span id="deleteFileName"></span>"?</p>
            <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            <div class="modal-buttons">
                <form id="deleteForm" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                </form>
                <button onclick="closeModal()" class="btn" style="background: #6c757d;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        function confirmDelete(docId, fileName) {
            document.getElementById('deleteFileName').textContent = fileName;
            document.getElementById('deleteForm').action = "{{ url_for('delete_document', doc_id=0) }}".replace('0', docId);
            document.getElementById('deleteModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('deleteModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>